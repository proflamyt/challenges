FROM ubuntu:24.04
RUN apt-get update && apt-get install -y cmake build-essential python3-pwntools git flex bison autoconf automake libtool libncurses5-dev vim
ADD --chown=0:0 --chmod=6755 http://github.com/pwncollege/exec-suid/releases/latest/download/exec-suid /usr/bin/exec-suid
COPY send_mutt_message.c crash_to_flag.c poc /challenge/
RUN <<'END'
    mkdir -p /challenge/bin
    cd /challenge

    git clone https://gitlab.com/muttmua/mutt.git 
    git config --global user.email "you@example.com"
    git config --global user.name "Your Name"
    git -C mutt revert 452ee330e094bfc7c9a68555e5152b1826534555
    git -C mutt diff HEAD^ > /challenge/patch.diff

    cd /challenge/mutt
    ./prepare
    ./configure --prefix=/challenge/
    make install
END

ENV PATH="/challenge/bin:$PATH"
